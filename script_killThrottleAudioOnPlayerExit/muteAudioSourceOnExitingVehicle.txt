-- Register the behaviour
behaviour("muteAudioSourceOnExitingVehicle")

function muteAudioSourceOnExitingVehicle:Start()
	-- Run when behaviour is created
	self.vehicle = self.targets.vehicleTarget.gameObject.getComponent(Vehicle)
	self.throttleAudio = self.transform.parent.gameObject.getComponent(AudioSource)
	self.playerWasInVehicle = false
	self.toggleAudio = false
end

-- for next update, check if there are any passengers left in the vehicle --
-- currently, I think the throttle audio stops when the player leaves, 
-- even if a bot immediately starts driving again? Maybe? --

-- no, check if the player was the driver when leaving the vehicle 
-- no need to mute if the bot was driving

function muteAudioSourceOnExitingVehicle:Update()
	-- Run every frame
	if self.vehicle.playerIsInside == true then
		if self.playerWasInVehicle == false then
			self.playerWasInVehicle = true
		end
		if self.toggleAudio == false then
			if self.vehicle.hasDriver then
				-- if there's a driver..
				-- turn volume back on
				self.toggleAudio = true 
				self.throttleAudio.mute = false
			end
		end
	else -- if player is not in vehicle..
		if self.playerWasInVehicle == true then
			--but if player WAS in vehicle last frame..
			self.playerWasInVehicle = false
			if self.throttleAudio.isPlaying == true then
				-- if audio is still playing..
				-- turn audio off.
				self.toggleAudio = false
				self.throttleAudio.mute = true
			end
		end
	end
end
